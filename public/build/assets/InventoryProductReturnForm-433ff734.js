import{F as o,s as X,u as Z,r as d,q as P,b as i,L as ee,j as t,ag as q,I as C,ah as r,aq as te,c as ae,be as se,bj as ne,a as u,m as re,t as v}from"./app-f44b5689.js";const ce=()=>{const[p]=o.useForm(),{inventory_id:_}=X(),g=Z(),N={key:0,product_id:null,u_of_m:null,sku:null,case_return:null,qty:1e5,qty_alocation:1},[y,m]=d.useState([N]),[S,O]=d.useState([]),[b,D]=d.useState([]),[k,R]=d.useState([]),[w,T]=d.useState([]),[x,F]=d.useState([]),[le,Y]=d.useState(!1),[V,j]=d.useState("draft"),[f,L]=d.useState(null),[I,M]=d.useState([]);d.useState([]);const A=()=>{u.get("/api/master/products").then(e=>{D(e.data.data)})},W=e=>{u.post("/api/master/list-case",e).then(a=>{const s=a.data.data;if(s.length>0){const l=s.map((n,c)=>({key:c,product_id:n.product_id,u_of_m:n.u_of_m,sku:n.sku,case_return:f,qty:n.qty,qty_alocation:1}));m(l)}})},E=()=>{u.get("/api/master/warehouse").then(e=>{R(e.data.data)})},B=()=>{u.get("/api/master/vendors").then(e=>{F(e.data.data)})},G=()=>{u.get("/api/master/company-account").then(e=>{T(e.data.data)})},H=()=>{u.get(`/api/inventory/product/return/detail/${_}`).then(e=>{const{data:a}=e.data;Y((a==null?void 0:a.status)!=="draft"),j(a==null?void 0:a.status),p.setFieldsValue({...a,received_date:moment(a.received_date||new Date,"YYYY-MM-DD"),expired_date:moment(a.expired_date||new Date,"YYYY-MM-DD")});const s=a.items.map((l,n)=>({key:n,product_id:l.product_id,price:l.price,qty:l.qty,sub_total:l.subtotal,sku:l.sku,u_of_m:l.u_of_m}));m(s)})},$=()=>{u.get("/api/inventory/info/created").then(e=>{p.setFieldsValue(e.data)})},z=()=>{u.get("/api/master/list-case").then(e=>{const{data:a}=e.data;O(a)})};d.useEffect(()=>{A(),E(),B(),G(),z(),_?H():$(),p.setFieldsValue({company_account_id:parseInt(P("account_id"))})},[]);const U=({dataIndex:e,value:a,key:s,product_id:l,type:n})=>{const c=[...y];if(c[s][e]=a,n==="change-product"){const h=b.find(Q=>Q.id===l);c[s].u_of_m=h==null?void 0:h.package_name,c[s].sku=h==null?void 0:h.sku}m(c)},J=({key:e,type:a})=>{const s=[...y];if(a==="add"){const n=s[s.length-1];return s.push({key:n.key+1,product_id:null,u_of_m:null,sku:null,case_return:null,qty:1,qty_alocation:1}),m(s)}if(a==="add-qty"){const n=s[e],c=parseInt(n.qty_alocation)+1;return s[e].qty_alocation=c,m(s)}if(a==="remove-qty"){const n=s[e];if(n.qty_alocation>1){const c=n.qty_alocation-1;return s[e].qty_alocation=c,m(s)}return m(s)}const l=s.filter(n=>n.key!==e);return m(l)},K=e=>{if(!y.every(n=>n.product_id))return re.error("Please select product");const s={...e,items:y,account_id:P("account_id")};let l="/api/inventory/product/return/save";_&&(s.inventory_id=_,l=`/api/inventory/product/return/update/${_}`),u.post(l,s).then(n=>(v.success(n.data.message,{position:v.POSITION.TOP_RIGHT}),g(-1))).catch(n=>{const{message:c}=n.response.data;v.error(c,{position:v.POSITION.TOP_RIGHT})})};return i(ee,{onClick:()=>g(-1),title:"Tambah Stok Produk",children:[i("div",{className:"",children:[i("div",{className:"flex justify-end items-center",children:[t("strong",{children:"Status :"}),t(q,{type:"primary",size:"middle",style:{marginLeft:10,backgroundColor:"#E3A008",borderColor:"#E3A008"},children:V.toUpperCase()})]}),t(o,{form:p,name:"basic",layout:"vertical",onFinish:K,autoComplete:"off",children:i("div",{className:"row",children:[i("div",{className:"col-md-6",children:[t(o.Item,{label:"Nomor SR",name:"nomor_sr",children:t(C,{placeholder:"Input Nomor SR",disabled:!0})}),t(o.Item,{label:"Sales Channel",name:"transaction_channel",rules:[{required:!0,message:"Please input Sales Channel!"}],children:i(r,{placeholder:"Select Sales Channel",children:[t(r.Option,{value:"corner",children:"Corner"}),t(r.Option,{value:"agent-portal",children:"Agent Portal"}),t(r.Option,{value:"distributor",children:"Distributor"}),t(r.Option,{value:"super-agent",children:"Super Agent"}),t(r.Option,{value:"modern-store",children:"Modern Store"})]})}),t(o.Item,{label:"Warehouse",name:"warehouse_id",rules:[{required:!0,message:"Please input Warehouse!"}],children:t(r,{placeholder:"Select Warehouse",children:k.map(e=>t(r.Option,{value:e.id,children:e.name},e.id))})}),t(o.Item,{label:"Created By",name:"created_by_name",children:t(C,{placeholder:" Created By",readOnly:!0})})]}),i("div",{className:"col-md-6",children:[t(o.Item,{label:"Company",name:"company_account_id",children:t(r,{placeholder:"Select Company",disabled:!0,children:w.map(e=>t(r.Option,{value:e.id,children:e.account_name},e.id))})}),t(o.Item,{label:"Received Date",name:"received_date",rules:[{required:!0,message:"Please input Received Date!"}],children:t(te,{className:"w-full"})}),t(o.Item,{label:"Return to Vendor",name:"vendor",rules:[{required:!0,message:"Please Return vendor!"}],children:t(r,{placeholder:"Select Return vendor",children:x.map(e=>t(r.Option,{value:e.name,children:e.name},e.code))})}),t(o.Item,{label:"Created On",name:"created_on",children:t(C,{placeholder:" Created On",readOnly:!0})})]}),t("div",{className:"col-md-12",children:t(o.Item,{label:"Notes",name:"note",children:t(ae,{placeholder:" Notes"})})}),t("div",{className:"col-md-6",children:t(o.Item,{label:"Case Type",name:"case_type",rules:[{required:!0,message:"Please input Case Type!"}],children:i(r,{placeholder:"Select Case Type",className:"w-full",onChange:e=>{L(e),M(S.filter(a=>a.type===e)),p.setFieldsValue({case_return:null})},children:[t(r.Option,{value:"manual",children:"Manual"}),t(r.Option,{value:"refund",children:"Refund"}),t(r.Option,{value:"return",children:"Return"})]})})}),t("div",{className:"col-md-6",children:t(o.Item,{label:"Case Return",name:"case_title",rules:[{required:!!f,message:"Please input Case Return!"}],children:t(r,{placeholder:"Select Case Return",className:"w-full",disabled:!f,onChange:e=>{const a=I.find(s=>s.name===e);W({case_type:a.type,case_title:a.name})},children:I.map(e=>t(r.Option,{value:e.name,children:e.name},e.id))})})})]})})]}),i("div",{className:"card mt-8",children:[t("div",{className:"card-header",children:t("div",{className:"header-titl",children:t("strong",{children:"Informasi Product Return Product"})})}),t("div",{className:"card-body",children:t(se,{data:y,products:b,cases:S,disabled:{product_id:!1,qty_alocation:!1},columns:ne,handleChange:U,handleClick:J})})]}),t("div",{className:"card p-6 ",children:t("div",{className:"flex justify-end",children:t(q,{color:"success",onClick:()=>p.submit(),children:"Simpan"})})})]})};export{ce as default};
