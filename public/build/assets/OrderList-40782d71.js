import{aq as _,r as n,j as e,b as s,C as B,ap as re,M as q,ah as p,as as oe,F as E,b9 as ie,q as ce,ba as de,t as u,L as ue,bb as me,I as he,o as ge,T as pe,p as fe,a as y,bc as be,d as Se,at as Ce,v as xe}from"./app-9807f797.js";import{c as Ne,o as Oe,a as ke}from"./config-e9aa7ea3.js";var we=globalThis&&globalThis.__rest||function(l,d){var o={};for(var r in l)Object.prototype.hasOwnProperty.call(l,r)&&d.indexOf(r)<0&&(o[r]=l[r]);if(l!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(l);i<r.length;i++)d.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(l,r[i])&&(o[r[i]]=l[r[i]]);return o},ve=_.TimePicker,Pe=_.RangePicker,ye=n.forwardRef(function(l,d){var o=l.dropdownClassName,r=l.popupClassName;return e(Pe,{...l,dropdownClassName:o,popupClassName:r,picker:"time",mode:void 0,ref:d})}),V=n.forwardRef(function(l,d){var o=l.addon,r=l.renderExtraFooter,i=l.popupClassName,h=l.dropdownClassName,S=we(l,["addon","renderExtraFooter","popupClassName","dropdownClassName"]),f=n.useMemo(function(){if(r)return r;if(o)return o},[o,r]);return e(ve,{dropdownClassName:h,popupClassName:i,...S,mode:void 0,ref:d,renderExtraFooter:f})});V.RangePicker=ye;const Te=V,{RangePicker:Ie}=_,_e=({handleOk:l})=>{const[d,o]=n.useState(!1),[r,i]=n.useState(!1),[h,S]=n.useState([]),[f,g]=n.useState({channel:null,sku:null,tanggal_transaksi:null,status:null}),O=()=>{o(!0)},w=()=>{axios.get("/api/master/sku").then(a=>{S(a.data.data)})};n.useEffect(()=>{w()},[]);const v=()=>{o(!1),i(!1),g({channel:null,sku:null,tanggal_transaksi:null,status:null})},c=(a,C)=>{i(!0),g({...f,[C]:a})},T=()=>{o(!1),i(!1),g({channel:null,sku:null,tanggal_transaksi:null,status:null}),l({})};return s("div",{children:[r?s("button",{onClick:()=>T(),className:"text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center",children:[e(B,{}),e("span",{className:"ml-2",children:"Clear Filter"})]}):s("button",{onClick:()=>O(),className:" bg-white border  text-blue-700 hover:text-blue-700/90 delay-100 ease-in-out focus:ring-4 focus:outline-none focus:ring-blue-300  font-medium rounded-lg  text-sm px-4 py-2 text-center inline-flex items-center ",children:[e(re,{}),e("span",{className:"ml-2",children:"Filter"})]}),e(q,{title:"Filter",open:d,onOk:()=>{l(f),o(!1)},onCancel:v,children:s("div",{children:[s("div",{children:[e("label",{htmlFor:"",children:"SKU"}),e(p,{allowClear:!0,className:"w-full mb-2",placeholder:"Select SKU",onChange:a=>c(a,"sku"),children:h.map(a=>e(p.Option,{value:a.sku,children:a.sku},a.sku))})]}),s("div",{children:[e("label",{htmlFor:"",children:"Channel"}),e(p,{mode:"multiple",allowClear:!0,className:"w-full mb-2",placeholder:"Select Channel",onChange:a=>c(a,"channel"),children:Ne.map(a=>e(p.Option,{value:a,children:a},a))})]}),s("div",{children:[e("label",{htmlFor:"",children:"Status"}),e(p,{mode:"multiple",allowClear:!0,className:"w-full mb-2",placeholder:"Select Order Status",onChange:a=>c(a,"status"),children:Oe.map(a=>e(p.Option,{value:a.value,children:a.name},a.value))})]}),s("div",{className:"w-full mb-2",children:[e("label",{htmlFor:"",children:"Tanggal Transaksi"}),e(Ie,{className:"w-full",format:"YYYY-MM-DD",onChange:(a,C)=>c(C,"tanggal_transaksi")})]}),s("div",{className:"w-full mb-2",children:[e("label",{htmlFor:"",children:"Status Submit"}),s(p,{allowClear:!0,className:"w-full mb-2",placeholder:"Select Status Submit",onChange:a=>c(a,"status_submit"),children:[e(p.Option,{value:"submited",children:"Submitted"}),e(p.Option,{value:"notsubmited",children:"Not Submitted"})]})]}),s("div",{className:"w-full mb-2",children:[e("label",{htmlFor:"",children:"Waktu Transaksi"}),e(Te.RangePicker,{defaultValue:oe(new Date,"h:mm A"),className:"w-full",format:"h:mm A",onChange:(a,C)=>c(C,"waktu_transaksi")})]})]})})]})},{RangePicker:Fe}=_,Me=({handleSubmit:l})=>{const[d]=E.useForm(),[o,r]=n.useState(!1),[i,h]=n.useState(null),[S,f]=n.useState(null),g=()=>{r(!0)},O=()=>{r(!1),d.resetFields()},w=c=>c&&c>moment().endOf("day"),v=c=>{h(c?[null,null]:null)};return s("div",{children:[s("button",{onClick:g,className:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center ml-4",children:[e(ie,{}),e("span",{className:"ml-2",children:"Sync Data"})]}),s(q,{title:"Sync Ginee",open:o,onOk:()=>{r(!1),d.submit()},onCancel:O,children:[s("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert",children:[e("strong",{className:"font-bold",children:"Perhatian!"}),e("span",{className:"block sm:inline",children:"Maksimal sync data adalah 15 hari"})]}),e(E,{form:d,name:"basic",layout:"vertical",onFinish:l,autoComplete:"off",children:e(E.Item,{label:"Start Date",name:"start_date",rules:[{required:!0,message:"Please input Start Date!"}],children:e(Fe,{value:i||S,disabledDate:w,onCalendarChange:c=>h(c),onChange:c=>{f(c)},onOpenChange:v,className:"w-full"})})})]})]})},Ge=()=>{const[l,d]=n.useState(!1),[o,r]=n.useState([]),[i,h]=n.useState(0),[S,f]=n.useState(1),[g,O]=n.useState(null),[w,v]=n.useState({}),[c,T]=n.useState(!1),[a,C]=n.useState(null),[x,F]=n.useState(null),[G,M]=n.useState(!1),[z,Y]=n.useState(0),[A,L]=n.useState(!0),[U,D]=n.useState(!1),[P,J]=n.useState([]),j=JSON.parse(localStorage.getItem("user_data")),I=ce("service_ginee_url"),W="d804f6dcafacf4804032",Z="ginee-development",k=(t="/api/genie/order/list",m=10,N={})=>{d(!0),y.post(I+t,{perpage:m,...N}).then(b=>{const{data:R,total:$,current_page:le}=b.data.data;h($),f(le),r(R),d(!1)}).catch(b=>{d(!1),u.error("Terjadi Kesalahan, Silahkan Coba Lagi",{position:u.POSITION.TOP_RIGHT})})};n.useEffect(()=>{k();const m=new de(W,{cluster:"ap1"}).subscribe(Z);C(m)},[]),n.useEffect(()=>{a&&a.bind&&(a.unbind("progress"),a.unbind("progress-submit"),a.bind("progress",function(t){t.sync?(F(t),k()):u.success("Sync data telah selesai",{position:u.POSITION.TOP_RIGHT})}),a.bind("progress-submit",function(t){M(t.progress),Y(t.percentage),t.progress||A&&(u.success("Submit Data Berhasil",{position:u.POSITION.TOP_RIGHT}),L(!1)),t.error&&(u.error("Submit Gagal,Silahkan Coba Lagi",{position:u.POSITION.TOP_RIGHT}),L(!1),M(!1),Y(0))}))},[a,x]);const Q=(t,m=10)=>{k(`/api/genie/order/list/?page=${t}`,m,{search:g,...w})},H=()=>{T(!0),k("/api/genie/order/list",10,{search:g})},K=(t,m={})=>t==="sync"?y.post(I+"/api/genie/order/"+t,m).then(N=>{const{message:b}=N.data;F({sync:!0,percentage:0}),u.success(b,{position:u.POSITION.TOP_RIGHT})}):y.get(I+"/api/genie/order/"+t).then(N=>{const{message:b}=N.data;F({sync:t==="sync",percentage:0}),u.success(b,{position:u.POSITION.TOP_RIGHT})}),X=t=>{v(t),k("/api/genie/order/list",10,t)},ee={selectedRowKeys:P,onChange:t=>J(t),getCheckboxProps:t=>({disabled:t.status_submit==="submited"})},te=t=>{if(P&&P.length<1)return u.error("Mohon Pilih Salah Satu",{position:u.POSITION.TOP_RIGHT});y.post(I+"/api/genie/sync/gp",{total:P.length,order_ids:P,user_id:j.id,name:j.name,...t}).then(m=>{m.data,M(!0)})},ae=()=>{D(!0),y.post("/api/genie-order/export/").then(t=>{const{data:m}=t.data;window.open(m),D(!1)}).catch(t=>D(!1))},ne=s("div",{className:"flex justify-between items-center",children:[e(be,{handleSubmit:te}),e(_e,{handleOk:X}),s("button",{className:"ml-3 text-white bg-green-800 hover:bg-green-800 focus:ring-4 focus:outline-none focus:ring-green-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center mr-2",onClick:()=>ae(),children:[U?e(Se,{}):e(Ce,{}),e("span",{className:"ml-2",children:"Export"})]}),e(Me,{handleSubmit:t=>{const m={start_date:t.start_date[0].format("YYYY-MM-DD"),end_date:t.start_date[1].format("YYYY-MM-DD")};let N=new Date(t.start_date[1]),b=new Date(t.start_date[0]),R=N.getTime()-b.getTime();if(Math.ceil(R/(1e3*3600*24))>15)return u.error("Maksimal 15 Hari",{position:u.POSITION.TOP_RIGHT});K("sync",{date:m})}})]}),se=s("div",{className:"flex justify-between items-center",children:[s("button",{className:"text-dark bg-white hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center disabled border-2 border-gray-300",disabled:!0,children:[e("img",{src:"https://i.ibb.co/V91rZKM/1497.gif",alt:"1497",style:{height:"20px"},border:"0"}),e("span",{className:"ml-2",children:"Proses Submit sedang Berlangsung"})]}),s("button",{onClick:()=>K("cancel-sync"),className:"text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center ml-4",children:[e(xe,{}),e("span",{className:"ml-2",children:"Cancel Sync"})]})]});return s(ue,{title:"Order List By Genie",rightContent:x!=null&&x.sync||G?se:ne,children:[s("div",{className:"row mb-4",children:[G&&e("div",{className:"col-md-12",children:e("div",{className:"card",children:s("div",{className:"card-body text-mainColor text-center",children:[e("p",{children:"Submit Data Sedang Berlangsung"}),e(me,{percent:z,status:"active"})]})})}),(x==null?void 0:x.sync)&&e("div",{className:"col-md-12",children:e("div",{className:"card",children:e("div",{className:"card-body text-mainColor text-center",children:s("p",{children:["Sinkronisasi data ginee sedang berlangsung, mohon tunggu",e("span",{id:"wait",children:"."})]})})})}),e("div",{className:"col-md-4 col-sm-6 col-12",children:e(he,{placeholder:"Cari disini",size:"large",className:"rounded",onPressEnter:()=>H(),suffix:c?e(B,{onClick:()=>{k(),O(null),T(!1)}}):e(ge,{onClick:()=>H()}),value:g,onChange:t=>O(t.target.value)})}),e("div",{className:"col-md-8",children:s("strong",{className:"float-right mt-3 text-red-400",children:["Total Data: ",i]})})]}),e(pe,{rowSelection:ee,dataSource:o,columns:ke,loading:l,pagination:!1,rowKey:"id",scroll:{x:"max-content"},tableLayout:"auto",theme:"dark"}),e(fe,{defaultCurrent:1,current:S,total:i,className:"mt-4 text-center",onChange:Q,pageSizeOptions:["10","20","50","100","200","500"]})]})};export{Ge as default};
