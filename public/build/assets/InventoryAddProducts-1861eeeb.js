import{F as n,s as G,u as $,r as p,b as _,L as E,j as e,I as f,ah as C,aq as M,c as z,bm as k,bn as J,n as D,bo as K,ag as Q,a as y,as as U,m as P,q as O,t as m}from"./app-8c157319.js";const Z=()=>{const[v]=n.useForm(),{inventory_id:u}=G(),w=$(),S={key:0,id:null,product_id:null,price:0,qty:1,qty_alocation:0,sub_total:0,from_warehouse_id:null,to_warehouse_id:null,sku:null,u_of_m:null},[l,c]=p.useState([S]),[b,A]=p.useState([]),[N,T]=p.useState([]),[q,F]=p.useState([]),[g,R]=p.useState({}),H=()=>{y.get("/api/master/product-lists").then(t=>{T(t.data.data)})},x=()=>{y.get("/api/master/warehouse").then(t=>{F(t.data.data)})},L=()=>{y.get(`/api/inventory/product/detail/${u}`).then(t=>{var i;const{data:a}=t.data;R(a),v.setFieldsValue({...a,received_date:U(a.received_date??new Date,"YYYY-MM-DD")});const s=((i=a.selected_po)==null?void 0:i.items.filter(d=>d.ref===u)).map((d,h)=>({key:h,id:d.id,product_id:d.product_id,price:d.price,qty:d.qty_can_allocated,qty_alocation:d.qty_can_allocated,sub_total:d.subtotal,from_warehouse_id:a.warehouse_id,to_warehouse_id:a.warehouse_id,sku:d.sku,u_of_m:d.uom})),o=a.history_allocations.map((d,h)=>({...d,key:h,qty:d.quantity}));A(o),c(s)})},V=()=>{y.get("/api/inventory/info/created").then(t=>{v.setFieldsValue(t.data)})};p.useEffect(()=>{H(),x(),u?L():V()},[]);const I=({dataIndex:t,value:a,key:r})=>{const s=[...l],o=s[r].from_warehouse_id,i=s[r].to_warehouse_id;if(a===null)return s[r][t]=null,c(s);if(t==="from_warehouse_id"){if(i===a)return P.error("From warehouse tidak boleh sama dengan to warehouse");s[r][t]=a}if(t==="to_warehouse_id"){if(o===a)return P.error("From warehouse tidak boleh sama dengan to warehouse");if(s.find(h=>h.to_warehouse_id===a)){const h=s.filter(B=>B.key!==r);return c(h)}else s[r][t]=a}t==="qty_alocation"&&(s[r][t]=a),c(s)},W=({key:t,type:a})=>{const r=[...l];if(a==="add"){const o=r[r.length-1];return r.push({key:o.key+1,id:0,product_id:o.product_id,price:0,qty:1,qty_alocation:0,sub_total:0,from_warehouse_id:o.from_warehouse_id,to_warehouse_id:null,sku:o.sku,u_of_m:o.u_of_m}),c(r)}if(a==="add-qty"){const o=r[t];if(o.qty_alocation+1<=o.qty){const i=o.qty_alocation+1;return r[t].qty_alocation=i,c(r)}return null}if(a==="remove-qty"){const o=r[t];if(o.qty_alocation>1){const i=o.qty_alocation-1;return r[t].qty_alocation=i,c(r)}return c(r)}const s=r.filter(o=>o.key!==t);return c(s)},j=t=>{if(!l.every(o=>o.product_id))return P.error("Please select product");const r={...t,items:l,account_id:O("account_id")};let s="/api/inventory/product/stock/save";u&&(r.inventory_id=u,s=`/api/inventory/product/stock/update/${u}`),y.post(s,r).then(o=>(m.success(o.data.message,{position:m.POSITION.TOP_RIGHT}),w(-1))).catch(o=>{const{message:i}=o.response.data;m.error(i,{position:m.POSITION.TOP_RIGHT})})},Y=()=>{if(!l.every(a=>a.to_warehouse_id))return m.error("Periksa kembali inputan anda");y.post(`/api/inventory/product/stock/allocated/${u}`,{items:l,account_id:O("account_id")}).then(a=>(m.success(a.data.message,{position:m.POSITION.TOP_RIGHT}),w(-1)))};return b.length>0,_(E,{onClick:()=>w(-1),title:"Detail Stock Product Received",children:[_("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"header-titl",children:e("strong",{children:"Form Received Product"})})}),e("div",{className:"card-body",children:e(n,{form:v,name:"basic",layout:"vertical",onFinish:j,autoComplete:"off",children:_("div",{className:"row",children:[_("div",{className:"col-md-6",children:[e(n.Item,{label:"Company",name:"company_name",rules:[{required:!0,message:"Please input Status!"}],children:e(f,{disabled:!0})}),e(n.Item,{label:"Vendor",name:"vendor",rules:[{required:!0,message:"Please input Vendor!"}],children:e(f,{placeholder:"Input Vendor",disabled:!0})}),e(n.Item,{label:"Created By",name:"created_by_name",children:e(f,{placeholder:" Created By",disabled:!0})})]}),_("div",{className:"col-md-6",children:[e(n.Item,{label:"Warehouse",name:"warehouse_id",rules:[{required:!0,message:"Please input Warehouse!"}],children:e(C,{placeholder:"Select Warehouse",disabled:!0,children:q.map(t=>e(C.Option,{value:t.id,children:t.name},t.id))})}),e(n.Item,{label:"Received Date",name:"received_date",rules:[{required:!0,message:"Please input Received Date!"}],children:e(M,{className:"w-full",disabled:!0})}),e(n.Item,{label:"Created On",name:"created_on",children:e(f,{placeholder:" Created On",disabled:!0})})]}),e("div",{className:"col-md-12",children:e(n.Item,{label:"Notes",name:"note",children:e(z,{placeholder:" Notes",disabled:!0})})})]})})})]}),_("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"header-titl",children:e("strong",{children:"Detail Product"})})}),e("div",{className:"card-body",children:e(k,{data:l,products:N,warehouses:q,disabled:{from_warehouse_id:!0,qty:!0,product_id:!0,to_warehouse_id:!0,action:!0},columns:J.filter(t=>!D(t.dataIndex,["action","from_warehouse_id","qty_alocation"])),handleChange:I,handleClick:W})})]}),_("div",{className:"card",children:[e("div",{className:"card-header",children:e("div",{className:"header-titl",children:e("strong",{children:"Allocation History"})})}),e("div",{className:"card-body",children:e(k,{data:b,products:N,warehouses:q,disabled:{from_warehouse_id:!0,qty:!0,product_id:!0,to_warehouse_id:!0},columns:K.filter(t=>t.dataIndex!=="from_warehouse_id"),handleChange:I})})]}),D(g==null?void 0:g.inventory_status,["received"])&&e("div",{className:"card p-6 ",children:e("div",{className:"flex justify-end",children:e(Q,{style:{backgroundColor:"#1A56DC",borderColor:"#1A56DC",color:"white"},onClick:()=>Y(),children:"Proses Allocated"})})})]})};export{Z as default};
