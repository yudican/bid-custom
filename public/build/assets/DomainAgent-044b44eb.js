import{r,j as e,A as te,_ as U,b as x,M as K,T as R,t as O,F as f,P as E,I as S,c as ae,U as ne,d as H,g as se,R as $,L as oe,S as le,D as ie,e as re,f as I,h as ce,E as de,i as ue,k as pe,l as me,a as v,m as j}from"./app-a358be14.js";import{A as he,c as ge,a as fe,b as be,d as Ce}from"./AgentListTable-baa9db6b.js";import{F as xe}from"./FolderFilled-f4f4cb03.js";import"./index-4db86e4b.js";var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"};const De=ke;var q=function(a,m){return e(te,{...U(U({},a),{},{ref:m,icon:De})})};q.displayName="ArrowLeftOutlined";const Le=r.forwardRef(q),Se=({agent_id:p})=>{const[a,m]=r.useState(!1),[g,s]=r.useState(null),[u,b]=r.useState(null),[D,c]=r.useState("Agent Detail"),[t,d]=r.useState(0),[C,_]=r.useState([]),[w,y]=r.useState([]),[h,l]=r.useState([]),[L,k]=r.useState(!1),P=()=>{k(!0),axios.get("/api/province-list").then(i=>{const{data:n}=i.data;k(!1),_(n)}).catch(i=>{k(!1)})},Y=i=>{y([]),axios.get("/api/city-list/"+i).then(n=>{const{data:A}=n.data;y(A)}).catch(n=>{k(!1)})},T=i=>{l([]),k(!0),axios.get("/api/agent-list/"+i).then(n=>{const{data:A}=n.data,ee=A.map((o,F)=>{var B,N,M;return{no:F+1,index:F,key:(B=o==null?void 0:o.agent)==null?void 0:B.user_id,nama:o.nama,telepon:o.telepon,alamat:o.alamat,libur:((N=o==null?void 0:o.agent)==null?void 0:N.libur)>0,active:((M=o==null?void 0:o.agent)==null?void 0:M.active)>0,order:o==null?void 0:o.order,status_agent:o==null?void 0:o.status_agent}});k(!1),l(ee||[])}).catch(n=>{})};r.useEffect(()=>{P()},[]);const z=()=>{if(t==1)d(t-1),c("Agent Management");else if(t==2){d(t-1);const i=C.find(n=>n.pid==g);c(`Agent Management - ${i==null?void 0:i.nama}`)}};r.useEffect(()=>{P()},[]);const J=i=>{axios.post("/api/agent/domain/toggle",{user_id:i,domain_id:p}).then(n=>{n.data,T(u),O.success("Domain Berhasil Disimpan",{position:O.POSITION.TOP_RIGHT})}).catch(n=>{k(!1)})},Q=[{title:"Kota/Kabupaten",dataIndex:"kota_kabupaten",key:"kota_kabupaten",render:(i,n,A)=>x("button",{onClick:()=>{t===0?(Y(n.pid),s(n.pid)):t===1&&(T(n.pid),b(n.pid)),d(t+1),c(`Agent Detail - ${n.nama}`)},className:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center",children:[e(xe,{}),e("span",{className:"ml-2",children:`Detail ${t===1?"Agent":"Kota/Kabupaten"}`})]})}],W=t==0?fe:be,X=t==0?C:w,Z=[...W,...Q],V=t>1;return x("div",{children:[e("span",{onClick:()=>m(!0),children:"Detail"}),e(K,{title:x("div",{className:"flex items-center",children:[e(Le,{className:"mr-3",onClick:()=>z()})," ",D]}),open:a,onOk:()=>{m(!1)},onCancel:()=>m(!1),okText:"Tutup",width:1e3,cancelButtonProps:{style:{display:"none"}},children:V?e(he,{dataSource:h.sort((i,n)=>i.order-n.order),handleChangeCell:({key:i})=>J(i),loading:L,columns:ge,refetch:()=>{u&&T(u)}}):e(R,{dataSource:X,columns:Z,loading:L,pagination:!1,rowKey:"index",scroll:{x:"max-content"},tableLayout:"auto"})})]})},G=({update:p=!1,initialValues:a={},refetch:m})=>{const[g]=f.useForm(),[s,u]=r.useState(!1),[b,D]=r.useState(!1),[c,t]=r.useState(null),[d,C]=r.useState(null),_=h=>{let l=new FormData;d&&l.append("icon",d),p&&l.append("agent_domain_id",a==null?void 0:a.id),l.append("name",h.name),l.append("url",h.url),l.append("color",h.color),l.append("back_color",h.back_color),l.append("description",h.description),l.append("status",h.status),l.append("fb_pixel",h.fb_pixel),l.append("status",p?a==null?void 0:a.status:1),axios.post(`/api/agent/domain/${p?"update":"save"}`,l).then(L=>{L.data,m(),C(null),u(!1),t(url),O.success("Domain Berhasil Disimpan",{position:O.POSITION.TOP_RIGHT})})},w=({fileList:h})=>{const l=h.pop();D(!0),setTimeout(()=>{se(l.originFileObj,L=>{D(!1),t(L)}),C(l.originFileObj)},1e3)},y=x("div",{children:[b?e(H,{}):e(E,{}),e("div",{style:{marginTop:8},children:"Upload"})]});return x("div",{children:[p?e("span",{onClick:()=>u(!0),children:"Update"}):x("button",{onClick:()=>u(!0),className:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center",children:[e(E,{}),e("span",{className:"ml-2",children:"Tambah Domain"})]}),e(K,{title:"Form Setting Domain",open:s,onOk:()=>{g.submit()},cancelText:"Batal",onCancel:()=>u(!1),okText:"Simpan",width:1e3,children:x(f,{form:g,name:"basic",layout:"vertical",initialValues:a,onFinish:_,autoComplete:"off",children:[e(f.Item,{label:"Nama Domain",name:"name",rules:[{required:!0,message:"Data tidak boleh kosong"}],children:e(S,{})}),e(f.Item,{label:"Url Domain",name:"url",rules:[{required:!0,message:"Data tidak boleh kosong"}],children:e(S,{})}),e(f.Item,{label:"Color",name:"color",rules:[{required:!0,message:"Data tidak boleh kosong"}],children:e(S,{})}),e(f.Item,{label:"Background Color",name:"back_color",rules:[{required:!0,message:"Data tidak boleh kosong"}],children:e(S,{})}),e(f.Item,{label:"Fb Pixel",name:"fb_pixel",placeholder:"Ex: 123456789,123456789",children:e(S,{})}),e(f.Item,{label:"Description",name:"description",placeholder:"Deskripsi",children:e(ae,{})}),e(f.Item,{label:"Icon",name:"icon",children:e(ne,{name:"icon",listType:"picture-card",className:"avatar-uploader",showUploadList:!1,multiple:!1,beforeUpload:()=>!1,onChange:w,children:c?b?e(H,{}):e("img",{src:c,alt:"avatar",style:{width:"100%"}}):y})})]})})]})},_e=()=>{const[p,a]=$.useState([]),[m,g]=$.useState(!0),s=()=>{v.get("/api/agent/domain").then(c=>{var t;a((t=c.data)==null?void 0:t.data),g(!1)}).catch(c=>{g(!1)})};r.useEffect(()=>(s(),()=>{}),[]);const u=({value:c,key:t})=>{const d=p.find(C=>C.id===t);v.post("/api/agent/domain/update",{...d,status:c?1:0,agent_domain_id:t}).then(C=>{s(),j.success("Update Status Success")})},b=({type:c,agent_id:t})=>{switch(c){case"show-agent":v.post("/api/agent/domain/list",{agent_domain_id:t,perpage:10}).then(d=>{console.log(d.data.data)});break;case"refetch":console.log("refetch"),s();break;case"confirm-delete":v.post("/api/agent/domain/delete",{agent_domain_id:t}).then(d=>{s(),j.success("Delete Domain Berhasil")}).catch(d=>{});break}},D=Ce.map(c=>({...c,onCell:t=>({record:t,dataIndex:c.dataIndex,handleChange:d=>u(d),handleClick:d=>b(d)})}));return e(oe,{title:"Domain Agent",rightContent:e(G,{refetch:()=>s()}),children:e(R,{components:{body:{cell:ye}},loading:m,columns:D,dataSource:p,scroll:{x:"max-content"},tableLayout:"auto",rowKey:"id"})})},ye=p=>{const{dataIndex:a,handleChange:m,handleClick:g,record:s,className:u}=p;return s?a==="status"?e("td",{className:u,children:e(le,{checked:s[a]>0,onChange:b=>m({value:b,dataIndex:a,key:s.id})})}):a==="icon"?e("td",{className:u,children:e("img",{src:s[a],style:{height:30},alt:"icon"})}):a==="id"?e("td",{className:u,children:e(ie.Button,{icon:e(re,{}),overlay:x(I,{itemIcon:e(ce,{}),children:[e(I.Item,{icon:e(de,{}),children:e(Se,{agent_id:s.id})}),e(I.Item,{icon:e(ue,{}),children:e(G,{initialValues:s,refetch:()=>g({type:"refetch",agent_id:s.id}),update:!0})}),e(pe,{title:"Yakin Hapus Alamat ini?",onConfirm:()=>g({type:"confirm-delete",agent_id:s.id}),okText:"Ya, Hapus",cancelText:"Batal",children:e(I.Item,{icon:e(me,{}),children:e("span",{children:"Hapus"})})})]}),onClick:()=>alert("detail")})}):e("td",{className:u,children:s[a]}):e("td",{})};export{_e as default};
