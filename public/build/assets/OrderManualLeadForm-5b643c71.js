import{j as e,T as s,ah as b,I as q,b as i,n as Ge,q as H,br as He,v as We,P as je,r as u,bs as Ve,o as U,M as $e,be as Ee,u as Ke,F as P,s as Qe,L as re,x as Ue,an as z,aY as oe,bK as ze,S as Ye,bt as Je,ak as x,a as C,t as v}from"./app-037e9539.js";import{M as Xe}from"./ModalBilling-a58b3f92.js";import{c as Ze,s as de,d as ie,b as Ae}from"./config-12687b4b.js";const ea=({products:k=[],handleChange:o,handleClick:g,onChange:y,data:_=[],taxs:l=[],discounts:d=[],loading:O=!1,disabled:B=!1,summary:m=null})=>{const c=Ze.map(T=>({...T,onCell:M=>({record:M,dataIndex:T.dataIndex,products:k,taxs:l,discounts:d,disabled:B,summary:m,handleChange:w=>o(w),handleClick:w=>g(w),onChange:w=>y(w)})}));return e("div",{children:e(s,{components:{body:{cell:aa}},dataSource:_,columns:c,loading:O,pagination:!1,rowKey:"id",scroll:{x:"max-content"},tableLayout:"auto",summary:m})})},aa=k=>{const{dataIndex:o,handleChange:g,handleClick:y,onChange:_,record:l,products:d,taxs:O,discounts:B,disabled:m}=k;return l?o==="product_id"?e("td",{children:e(ta,{style:{marginBottom:17},products:d,handleChange:c=>g({value:c,dataIndex:o,key:l.id,uid_lead:l.uid_lead}),disabled:m,value:l==null?void 0:l.product_id})}):o==="tax_id"?e("td",{children:e(b,{style:{marginBottom:17},disabled:m,placeholder:"Select Tax",value:l.tax_id,onChange:c=>{m||g({value:c,dataIndex:o,key:l.id,uid_lead:l.uid_lead})},children:O.map(c=>e(b.Option,{value:c.id,children:c.tax_code},c.id))})}):o==="discount_id"?e("td",{children:e(b,{style:{marginBottom:17},placeholder:"Select Discount",value:l.discount_id,disabled:m||l.disabled_discount,onChange:c=>{m||g({value:c,dataIndex:o,key:l.id,uid_lead:l.uid_lead})},children:B.map(c=>e(b.Option,{value:c.id,children:c.title},c.id))})}):o==="final_price"?e("td",{children:e(q,{disabled:!0,value:l[o],style:{marginBottom:17}})}):o==="price_nego"?i("td",{children:[e(q,{disabled:m||(l==null?void 0:l.disabled_price_nego),value:l[o],type:"number",onChange:c=>{if(c.target.value>0)return _({value:c.target.value,dataIndex:o,key:l.key,uid_lead:l.uid_lead})},onBlur:()=>{m||g({value:l[o],dataIndex:o,key:l.id,uid_lead:l.uid_lead})}}),Ge(H("role"),["admin","finance","superadmin"])&&i("span",{children:["Margin: ",l==null?void 0:l.margin_price]})]}):o==="qty"?m?e("td",{children:i("div",{className:"input-group input-spinner mr-3",style:{marginBottom:17},children:[e("button",{className:"btn btn-light btn-xs border",type:"button",disabled:m,children:e("i",{className:"fas fa-minus"})}),e("button",{className:"btn btn-light btn-xs border",type:"button",children:l[o]}),e("button",{className:"btn btn-light btn-xs border",type:"button",disabled:m,children:e("i",{className:"fas fa-plus"})})]})}):e("td",{children:i("div",{className:"input-group input-spinner mr-3",style:{marginBottom:17},children:[e("button",{className:"btn btn-light btn-xs border",type:"button",onClick:()=>y({key:l.id,type:"remove-qty",uid_lead:l.uid_lead}),children:e("i",{className:"fas fa-minus"})}),e(q,{disabled:m,value:l[o],onChange:c=>c.target.value>-1?_({value:c.target.value,dataIndex:o,key:l.key,uid_lead:l.uid_lead}):null,onBlur:c=>{m||g({value:l[o],dataIndex:o,key:l.id,uid_lead:l.uid_lead})},style:{width:"100px"},controls:!1}),e("button",{className:"btn btn-light btn-xs border",type:"button",onClick:()=>y({key:l.id,type:"add-qty",uid_lead:l.uid_lead}),children:e("i",{className:"fas fa-plus"})})]})}):o==="action"?m?e("td",{children:e("button",{className:"text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center",style:{marginBottom:17},children:e(He,{})})}):l.key>0?e("td",{children:e("button",{onClick:()=>y({key:l.id,type:"delete",uid_lead:l.uid_lead}),className:"text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center",style:{marginBottom:17},children:e(We,{})})}):e("td",{children:e("button",{onClick:()=>y({key:l.id,type:"add",uid_lead:l.uid_lead}),className:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center",style:{marginBottom:17},children:e(je,{})})}):e("td",{children:e(q,{value:l[o],disabled:m,style:{marginBottom:17},readOnly:!0})}):e("td",{colSpan:6,children:e("span",{children:"Tidak Ada Data"})})},ta=({products:k,handleChange:o,value:g,disabled:y=!1,style:_})=>{var w;const[l,d]=u.useState(!1),[O,B]=u.useState(null),[m,c]=u.useState(""),T=(w=k==null?void 0:k.find(h=>(h==null?void 0:h.id)===g))==null?void 0:w.name,M=k.filter(h=>h.name.toLowerCase().includes(m))||k;return i("div",{style:_,children:[e(Ve,{title:T,children:y?i("div",{className:"w-96 flex items-center bg-gray-100 border py-1 px-2 rounded-sm line-clamp-1 cursor-pointer",children:[e(U,{className:"mr-2"}),e("span",{children:g?T:"Select Product"})]}):i("div",{className:"w-96 flex items-center border py-1 px-2 rounded-sm line-clamp-1 cursor-pointer",onClick:()=>d(!0),children:[e(U,{className:"mr-2"}),e("span",{children:g?T:"Select Product"})]})}),e($e,{title:"List Product",open:l,cancelText:"Batal",okText:"Pilih",onOk:()=>{o(O),d(!1)},onCancel:()=>d(!1),width:900,children:i("div",{children:[e(q,{placeholder:"Cari produk disini..",size:"large",className:"rounded mb-4",suffix:e(U,{}),value:m,onChange:h=>c(h.target.value)}),M.map(h=>{var F;return e("div",{className:`
                mb-4 shadow-none rounded-md p-2 cursor-pointer bg-white
                ${O==h.id?"border-[1px] border-blue-400 drop-shadow-md ring-blue-500":"border border-gray-400"}
              `,onClick:()=>{B(h.id)},children:i("div",{className:"flex max-w-[800px] justify-between items-center",children:[i("div",{className:"flex items-center",children:[e("img",{src:h.image_url,alt:"product_photo",className:"mr-4 w-20 h-20 rounded-md border"}),i("div",{children:[i("div",{className:"block text-lg line-clamp-1 font-medium max-w-2xl",children:[h.name," "]}),e("br",{}),i("div",{className:"block",children:["Tersedia di :"," ",(F=h==null?void 0:h.sales_channels)==null?void 0:F.map((W,j)=>e(Ee,{color:"lime",children:W},j))]})]})]}),i("div",{className:"block text-red-500",children:["Stock Tersedia: ",h.stock_off_market]})]})},h.id)})]})})]})},ra=()=>{const k=Ke(),[o]=P.useForm(),g=H("role"),y=H("user_data",!0),{uid_lead:_}=Qe(),l=[{product_id:null,price:null,qty:1,tax_id:null,discount_id:null,final_price:null,total_price:null,uid_lead:_,margin_price:0,price_product:0,price_nego:0,total_price_nego:0,stock:0,id:0,key:0}],[d,O]=u.useState(null),[B,m]=u.useState([]),[c,T]=u.useState([]),[M,w]=u.useState([]),[h,F]=u.useState([]),[W,j]=u.useState([]),[ce,ue]=u.useState([]),[me,he]=u.useState([]),[I,Y]=u.useState(l),[pe,G]=u.useState(!1),[fe,ge]=u.useState([]),[J,V]=u.useState(!1),[_e,be]=u.useState([]),[ye,Se]=u.useState([]),[X,Z]=u.useState(!1),[A,Ce]=u.useState(!1),[$,ee]=u.useState(0),[p,xe]=u.useState(null),[E,ve]=u.useState(null),[L,ae]=u.useState(null),ke=()=>{C.get("/api/master/brand").then(t=>{F(t.data.data)})},Ne=()=>{C.get("/api/master/warehouse").then(t=>{m(t.data.data)})},we=()=>{C.get("/api/master/bin").then(t=>{T(t.data.data)})},te=t=>{C.get("/api/general/user-with-address/"+t).then(r=>{xe(r.data.data)})},Pe=()=>{C.get("/api/master/top").then(t=>{w(t.data.data)})},ne=t=>{C.get("/api/master/products/sales-offline").then(r=>{const{data:n}=r.data,a=n.map(f=>{const N=(f.stock_warehouse&&f.stock_warehouse.length>0&&(f==null?void 0:f.stock_warehouse)||[]).find(D=>D.id==t);return{...f,stock_off_market:(N==null?void 0:N.stock)||0}});j(a)})},Ie=()=>{C.get("/api/master/taxs").then(t=>{ue(t.data.data)})},Oe=()=>{C.get("/api/master/discounts/sales-offline").then(t=>{he(t.data.data)})},K=()=>{C.get(`/api/order-manual/billing/list/${_}`).then(t=>{const{data:r}=t.data;if(r&&r.length>0){const n=r.map(a=>({id:a.id,account_name:a.account_name,account_bank:a.account_bank,total_transfer:x(a.total_transfer),transfer_date:a.transfer_date,upload_billing_photo:a.upload_billing_photo_url,upload_transfer_photo:a.upload_transfer_photo_url,status:a.status,notes:a.notes??"-",approved_by_name:a.approved_by_name,approved_at:a.approved_at||"-",payment_number:a.payment_number||"-"}));ge(n)}})},le=(t=!0)=>{V(!0),C.get(`/api/order-manual/${_}`).then(r=>{var a,f,S,N,D;const{data:n}=r.data;if(V(!1),O(n),t){ae({label:n==null?void 0:n.contact_name,value:(a=n==null?void 0:n.contact_user)==null?void 0:a.id});const R={...n,contact:{label:n==null?void 0:n.contact_name,value:(f=n==null?void 0:n.contact_user)==null?void 0:f.id},sales:{label:(S=n==null?void 0:n.sales_user)==null?void 0:S.name,value:(N=n==null?void 0:n.sales_user)==null?void 0:N.id},payment_terms:(D=n==null?void 0:n.payment_term)==null?void 0:D.id};g==="sales"&&(R.sales={label:y.name,value:y.id}),o.setFieldsValue(R),Z(R.payment_terms===4),ne(n==null?void 0:n.warehouse_id)}else L&&o.setFieldValue("contact",{label:L==null?void 0:L.label,value:L==null?void 0:L.value});K()}).catch(r=>V(!1))},Q=()=>{C.get(`/api/order-manual/product-need/${_}`).then(t=>{const{data:r}=t.data;if(r&&r.length>0){const n=r==null?void 0:r.map((a,f)=>{var S,N,D,R;return{key:f,id:a.id,product:((S=a==null?void 0:a.product)==null?void 0:S.name)||"-",product_id:a==null?void 0:a.product_id,price:x((N=a==null?void 0:a.prices)==null?void 0:N.final_price),qty:a==null?void 0:a.qty,total_price:x(((D=a==null?void 0:a.prices)==null?void 0:D.final_price)*(a==null?void 0:a.qty)),final_price:x(a==null?void 0:a.final_price),margin_price:x(a==null?void 0:a.margin_price),discount_id:a==null?void 0:a.discount_id,tax_id:a==null?void 0:a.tax_id,tax_amount:x(a==null?void 0:a.tax_amount),uid_lead:_,stock:(R=a==null?void 0:a.product)==null?void 0:R.stock_off_market,price_nego:a==null?void 0:a.price_nego,price_product:x(a==null?void 0:a.price),total_price_nego:x(a==null?void 0:a.price_nego),disabled_discount:a==null?void 0:a.disabled_discount,disabled_price_nego:a==null?void 0:a.disabled_price_nego}});Y(n),le(!1)}})};u.useEffect(()=>{K(),ke(),Ne(),we(),Pe(),Ie(),Oe(),le(),Q(),Te(),Be()},[]);const Te=()=>{de(null).then(t=>{const r=t.map(n=>({label:n.nama,value:n.id}));be(r)})},Be=()=>{ie(null).then(t=>{const r=t.map(n=>({label:n.nama,value:n.id}));Se(r)})},Le=async t=>de(t).then(r=>r.map(a=>({label:a.nama,value:a.id}))),De=async t=>ie(t).then(r=>r.map(a=>({label:a.nama,value:a.id}))),Re=({dataIndex:t,value:r,key:n})=>{console.log(t,r,"handle change product price");const a=[...I];a[n][t]=r,Y(a)},qe=({dataIndex:t,value:r,key:n})=>{console.log(t,r,"handle change product");const a=I.find(f=>f.id===n)||{};G(!0),C.post("/api/lead-master/product-needs",{...a,[t]:parseInt(r),final_price:a==null?void 0:a.price_nego,price:a==null?void 0:a.price_product,key:n,item_id:n>0?n:null}).then(f=>{G(!1),Q()})},se=t=>{const r=t.type==="add"?l[0]:{};G(!0),C.post(`/api/order-manual/product-items/${t.type}`,{...t,...r,item_id:t.key,uid_lead:_}).then(n=>{const{message:a}=n.data;Q(),G(!1),v.success(a,{position:v.POSITION.TOP_RIGHT})})},Me=t=>{se({...t,newData:!1}),I.length===1&&I[0].id===0&&se({...t,newData:!0})},Fe=t=>{if(!I.every(S=>S.product_id)){v.error("Product harus diisi",{position:v.POSITION.TOP_RIGHT});return}if(E||v.error("Alamat Belum Dipilih",{position:v.POSITION.TOP_RIGHT}),!I.every(S=>S.qty>0)){v.error("Minimal Pembalian adalah 1",{position:v.POSITION.TOP_RIGHT});return}const a=X?2:1,f=$<0?$:a;C.post("/api/order-manual/form/save",{...t,status:f,status_save:d==null?void 0:d.status,uid_lead:_,address_id:E,contact:t.contact.value,sales:t.sales.value,kode_unik:d==null?void 0:d.kode_unik,product_items:I,account_id:H("account_id"),type:"manual"}).then(S=>(v.success(S.data.message,{position:v.POSITION.TOP_RIGHT}),k("/order/manual/order-lead"))).catch(S=>{const{message:N}=S.response.data;v.error(N,{position:v.POSITION.TOP_RIGHT})})};return J?e(re,{title:"Detail",href:"/order/manual/order-lead",children:e(Ue,{})}):i(re,{title:"Order Manual Form",href:"/order/manual/order-lead",children:[e(P,{form:o,name:"basic",layout:"vertical",onFinish:Fe,autoComplete:"off",children:e(z,{title:"Form Order",children:i("div",{className:"card-body row",children:[i("div",{className:"col-md-4",children:[e(P.Item,{label:"Type Customer",name:"type_customer",rules:[{required:!0,message:"Please input Type Customer!"}],children:i(b,{placeholder:"Select Type Customer",children:[e(b.Option,{value:"new",children:"New Customer"},"new"),e(b.Option,{value:"existing",children:"Existing Customer"},"existing")]})}),e(P.Item,{label:"Brand",name:"brand_id",rules:[{required:!0,message:"Please input your Brand!"}],children:e(b,{placeholder:"Select Brand",children:h.map(t=>e(b.Option,{value:t.id,children:t.name},t.id))})})]}),i("div",{className:"col-md-4",children:[e(P.Item,{label:"Contact",name:"contact",rules:[{required:!0,message:"Please input Contact!"}],children:e(oe,{showSearch:!0,placeholder:"Cari Contact",fetchOptions:Le,filterOption:!1,defaultOptions:_e,className:"w-full",onChange:t=>{te(t.value),ae(t)}})}),e(P.Item,{label:"Payment Term",name:"payment_terms",rules:[{required:!0,message:"Please input your Payment Term!"}],children:e(b,{placeholder:"Select Payment Term",onChange:t=>{Z(t===4),Ce(t===3)},children:M.map(t=>e(b.Option,{value:t.id,children:t.name},t.id))})})]}),i("div",{className:"col-md-4",children:[e(P.Item,{label:"Sales",name:"sales",rules:[{required:!0,message:"Please input Sales!"}],children:e(oe,{disabled:g==="sales",defaultOptions:g==="sales"?[{label:y.name,value:y.id}]:ye,showSearch:!0,placeholder:"Cari Sales",fetchOptions:De,filterOption:!1,className:"w-full"})}),e(P.Item,{label:"Warehouse",name:"warehouse_id",rules:[{required:!0,message:"Please input your Warehouse!"}],children:e(b,{placeholder:"Select Warehouse",onChange:t=>{ne(t)},children:B.map(t=>e(b.Option,{value:t.id,children:t.name},t.id))})})]}),A&&e("div",{className:"col-md-4",children:e(P.Item,{label:" Lokasi BIN",name:"master_bin_id",rules:[{required:!0,message:"Please input your Warehouse!"}],children:e(b,{placeholder:"Pilih Lokasi BIN",children:c.map(t=>e(b.Option,{value:t.id,children:t.name},t.id))})})}),e("div",{className:A?"col-md-8":"col-md-12",children:e(P.Item,{label:"Customer Need",name:"customer_need",children:e(q,{placeholder:"Ketik Customer Need"})})}),e("div",{className:"col-md-12"})]})})}),e(z,{title:"Informasi Alamat",className:"mt-4",extra:e(ze,{initialValues:{user_id:p==null?void 0:p.id,nama:p==null?void 0:p.name,telepon:(p==null?void 0:p.telepon)||(p==null?void 0:p.phone)},refetch:()=>te(p==null?void 0:p.id)}),children:e(s,{dataSource:(p==null?void 0:p.address)||[],columns:[{title:"No.",dataIndex:"no",key:"no",render:(t,r,n)=>n+1},{title:"Alamat",dataIndex:"alamat_detail",key:"alamat_detail"},{title:"Pilih",dataIndex:"action",key:"action",render:(t,r)=>e(Ye,{onChange:n=>ve(r.id),checked:E==r.id})}],pagination:!1},"id")}),e(z,{title:"Detail Product",className:"mt-4",children:e(ea,{data:I,products:W,taxs:ce,discounts:me,onChange:Re,handleChange:qe,handleClick:Me,loading:pe,summary:t=>{if(I.length>0)return i(Je,{children:[i(s.Summary.Row,{children:[e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{children:"Subtotal"}),e(s.Summary.Cell,{children:x(d==null?void 0:d.subtotal,"Rp ")}),e(s.Summary.Cell,{})]}),i(s.Summary.Row,{children:[e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{children:"Tax"}),e(s.Summary.Cell,{children:x(d==null?void 0:d.tax_amount,"Rp ")}),e(s.Summary.Cell,{})]}),i(s.Summary.Row,{children:[e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{children:"Discount"}),e(s.Summary.Cell,{children:x(d==null?void 0:d.discount_amount,"Rp ")}),e(s.Summary.Cell,{})]}),i(s.Summary.Row,{children:[e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{}),e(s.Summary.Cell,{children:"Total"}),e(s.Summary.Cell,{children:x(d==null?void 0:d.amount,"Rp ")}),e(s.Summary.Cell,{})]})]})}})}),X&&i("div",{className:"card mt-8",children:[i("div",{className:"card-header flex justify-between items-center",children:[e("h1",{className:"header-title",children:"Informasi Penagihan"}),e(Xe,{detail:{...d,uid_lead:_},refetch:K,user:y})]}),e("div",{className:"card-body",children:e(s,{dataSource:fe,columns:[...Ae],loading:J,pagination:!1,rowKey:"id",scroll:{x:"max-content"},tableLayout:"auto"})})]}),e("div",{className:"float-right",children:i("div",{className:"  w-full mt-6 p-4 flex flex-row",children:[!d&&e("button",{onClick:()=>{ee(-1),setTimeout(()=>{console.log("status",$),o.submit()},1e3)},className:"text-blue bg-white hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 border font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center mr-2",children:e("span",{className:"ml-2",children:"Save Draft"})}),e("button",{onClick:()=>{ee(1),setTimeout(()=>{o.submit()},1e3)},className:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 text-center inline-flex items-center",children:e("span",{className:"ml-2",children:"Save Order"})})]})})]})};export{ra as default};
